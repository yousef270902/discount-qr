<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<title>Admin Panel</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/qrcodejs/qrcode.min.js"></script>
<style>
body { background: #f8f9fa; font-family: Arial, sans-serif; }
.card { border-radius: 15px; }
.download-btn { margin-left: 5px; }
.qr-cell { width: 130px; }
</style>
</head>

<body>
<div class="container py-4">
    <h2 class="mb-4 text-center">ğŸ› ï¸ Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</h2>

    <!-- Ø²Ø± Export Data.js -->
    <div class="mb-3 text-center">
        <button class="btn btn-success" onclick="exportData()">ğŸ’¾ Export Data.js</button>
    </div>

    <!-- Card Ù„Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬ Ø¬Ø¯ÙŠØ¯ -->
    <div class="card p-3 mb-4 shadow-sm">
        <h5>â• Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬ Ø¬Ø¯ÙŠØ¯</h5>
        <div class="row g-2 align-items-center">
            <div class="col-md-5">
                <input id="pname" class="form-control" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬">
            </div>
            <div class="col-md-4">
                <input id="pprice" type="number" class="form-control" placeholder="Ø§Ù„Ø³Ø¹Ø±">
            </div>
            <div class="col-md-3">
                <button class="btn btn-primary w-100" onclick="addProduct()">Ø¥Ø¶Ø§ÙØ©</button>
            </div>
        </div>
    </div>

    <!-- Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª -->
    <div class="card p-3 shadow-sm">
        <h5>ğŸ“¦ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</h5>
        <table class="table table-bordered table-striped align-middle mb-0">
            <thead class="table-dark">
                <tr>
                    <th>Ø§Ù„Ø§Ø³Ù…</th>
                    <th>Ø§Ù„Ø³Ø¹Ø±</th>
                    <th>QR Code</th>
                    <th>ØªØ­Ù…ÙŠÙ„ QR</th>
                    <th>Ø­Ø°Ù</th>
                </tr>
            </thead>
            <tbody id="productsTable"></tbody>
        </table>
    </div>
</div>

<script src="data.js"></script>
<script>
let products = {...window.APP_DATA.products}; // Ù†Ø³Ø® Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª

function render() {
    const table = document.getElementById("productsTable");
    table.innerHTML = "";

    for (let id in products) {
        const p = products[id];

        const tr = document.createElement("tr");

        tr.innerHTML = `
            <td>${p.name}</td>
            <td>${p.price} Ø¬Ù†ÙŠÙ‡</td>
            <td class="qr-cell" id="qr${id}"></td>
            <td>
                <button class="btn btn-sm btn-secondary download-btn" onclick="downloadQR(${id})">â¬‡ï¸ ØªØ­Ù…ÙŠÙ„</button>
            </td>
            <td>
                <button class="btn btn-sm btn-danger" onclick="del(${id})">Ø­Ø°Ù</button>
            </td>
        `;

        table.appendChild(tr);

        // ØªÙˆÙ„ÙŠØ¯ QR
        new QRCode(document.getElementById("qr"+id), {
            text: "https://yousef270902.github.io/discount-qr/discount.html?product=" + id,
            width: 30,
            height: 30
        });
    }
}

function addProduct() {
    const name = document.getElementById("pname").value.trim();
    const price = document.getElementById("pprice").value;

    if (!name || !price) { alert("Ø§Ø¯Ø®Ù„ Ø§Ù„Ø§Ø³Ù… ÙˆØ§Ù„Ø³Ø¹Ø±"); return; }

    const id = Date.now();
    products[id] = { name, price };
    document.getElementById("pname").value = "";
    document.getElementById("pprice").value = "";
    render();
}

function del(id) {
    if(confirm("Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ù…Ù†ØªØ¬ØŸ")) {
        delete products[id];
        render();
    }
}

function downloadQR(id) {
    const qrImg = document.getElementById("qr"+id).querySelector("img");
    if(qrImg){
        const link = document.createElement("a");
        link.href = qrImg.src;
        link.download = products[id].name + "_QR.png";
        link.click();
    }
}

// ÙˆØ¸ÙŠÙØ© Export Data.js Ù„ØªØ­Ø¯ÙŠØ« GitHub
function exportData() {
    const dataStr = "window.APP_DATA = " + JSON.stringify({settings: window.APP_DATA.settings, products: products}, null, 2) + ";";
    const blob = new Blob([dataStr], {type: "text/javascript"});
    const link = document.createElement("a");
    link.href = URL.createObjectURL(blob);
    link.download = "data.js";
    link.click();
}

render();
</script>
</body>
</html>




